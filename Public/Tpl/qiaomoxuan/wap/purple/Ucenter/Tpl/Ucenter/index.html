<link rel="stylesheet" href="__UCSS__global.css">
<script src="__UJS__ucenter.js"></script>
<script src="__PUBLIC__/Lib/jquery/js/jquery.form.js"></script>
<script src="__PUBLIC__/Lib/jquery/js/jquery-ui-1.9.2.custom.js"></script>
<script src="__PUBLIC__/Lib/validate/jquery.validate.1.9.js"></script>
<script src="__PUBLIC__/Lib/validate/jquery.metadata.js"></script>
<script src="__PUBLIC__/Wap/time/js/mobiscroll.core-2.5.2.js" type="text/javascript"></script>
<script src="__PUBLIC__/Wap/time/js/mobiscroll.core-2.5.2-zh.js" type="text/javascript"></script>
<link href="__PUBLIC__/Wap/time/css/mobiscroll.core-2.5.2.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Wap/time/css/mobiscroll.animation-2.5.2.css" rel="stylesheet" type="text/css" />
<script src="__PUBLIC__/Wap/time/js/mobiscroll.datetime-2.5.1.js" type="text/javascript"></script>
<script src="__PUBLIC__/Wap/time/js/mobiscroll.datetime-2.5.1-zh.js" type="text/javascript"></script>
<!-- S 可根据自己喜好引入样式风格文件 -->
<script src="__PUBLIC__/Wap/time/js/mobiscroll.android-ics-2.5.2.js" type="text/javascript"></script>
<link href="__PUBLIC__/Wap/time/css/mobiscroll.android-ics-2.5.2.css" rel="stylesheet" type="text/css" />
<style>
    .spanWrong{
        margin-left:166px;
        color:#ff0000;
    }
</style>
<!--content-->
<div class="container"><!--container-->
    <div class="titleTop"> <!--detailTop-->
        <p class="detailT"><a href="#">首页</a>/<a href="#">个人中心</a></p>
        <h1><span>个人中心</span></h1>
    </div>

    <div class="Ucenter">
        <!--userInfo-->
        <div class="userInfo" id="userInfo">
            <script>
                getcommoninfo();
            </script>
        </div>
        <!--userInfo-->
    </div>
    <div class="ucenter_S">
        <div class="selectort"><span class="select">个人信息</span>
            <ul style="display: none;">
                <li><a href="{:U('Wap/My/pageProfile')}" selectid="1">个人信息</a></li>
                <li><a href="{:U('Wap/Orders/orderList')}"  selectid="2">我的订单</a></li>
                <li><a href="{:U('Wap/My/pageDeliver')}" selectid="4">我的地址</a></li>
                <li><a href="{:U('Wap/Message/pageMailBox')}" selectid="5">站内消息</a></li>
                <li><a href="{:U('Wap/Collect/pagelist')}" selectid="6">收藏列表</a></li>
                <li><a href="{:U('Wap/PointLog/pagelist')}" selectid="8">我的积分</a></li>
                <li><a href="{:U('Wap/Coupon/couponList')}" selectid="9">我的优惠券</a></li>
            </ul>
        </div>
    </div>
        <div class="userEdit">
            <form id="my_doedit" method="post" action="{:U('Wap/My/doEdit')}" enctype="multipart/form-data">
            <div class="infoL">
                <h1>修改个人信息</h1>
                <div class="orderD orderE"><span class="addr_edit">登录名</span> <span class="username">{$info.m_name}</span> </div>
                <div class="orderD orderE"><span class="name">真实姓名</span>
                    <input type="text" class="input_order" name="m_real_name" value="{$info['m_real_name']}">
                </div>
          <div class="orderD orderE">
              <span class="name">性别</span>
              <span class="sex">
          <div class="verify">
              <label class="tranfer">
                  <input type="radio" name="sex" value="1" <if condition="$info['m_sex'] eq '1'">checked="checked"</if>>
                  男
              </label>
          </div>
          <div class="verify">
              <label class="tranfer">
                  <input type="radio" name="sex" value="0" <if condition="$info['m_sex'] eq '0'">checked="checked"</if>>
                  女
              </label>
          </div>
          </span>
          </div>
                <div class="orderD orderE"><span class="birth">生日</span>
                    <input type="text" class="input_order" name="m_birthday" id="m_birthday" value="{$info.m_birthday}" validate="{ isCheck:true,messages:{isCheck:'您输入的参数非法，请重新输入'}}">
                </div>
                <div><span class="spanWrong"></span></div>

                <div class="orderD orderE"><span class="email">电子邮箱</span>
                    <input type="text" class="input_order" name="m_email" value="{$info.m_email}">
                </div>
               <div><span class="spanWrong"></span></div>

                <div class="orderD orderE">
                    <span class="addr_edit"></span>
                    <input type="hidden" name="m_id" value="{$info.m_id}" id="m_id" >
                    <button type="submit" class="confirm_save" style="background-color:#ffffff;color:#5f1785">保存</button>
                    <span class="addr_edit"></span>
					<a href="{:U('Wap/My/pageProfile')}" >查看详情</a>
                </div>
            </div>
            </form>

            <form method="post" action="#" id="edit_changePass">
            <div class="infoL">
                <h1>修改密码</h1>
                <div class="member_editpass" style="display: none;">
                    <b>原密码不正确！</b>
                </div>
                <div class="orderD orderE"><span class="old_pwd">旧密码</span>
                    <input type="password" class="input_order" name="m_password" id="m_password" validate="{ required:true,rangelength:[4,16],messages:{required:'密码不能为空',rangelength:'密码至少4位且不能多于16位'}}">
                </div>
                <div><span class="spanWrong"></span></div>
                <div class="orderD orderE"><span class="new_pwd">新密码</span>
                    <input type="password" class="input_order" id="new_m_password" name="new_m_password" validate="{ required:true,rangelength:[4,16],messages:{required:'新密码不能为空',rangelength:'密码至少4位'}}">
                </div>
                <div><span class="spanWrong"></span></div>
                <div class="orderD orderE"><span class="new_pwd">确认新密码</span>
                    <input type="password" class="input_order" id="confirmPassword" name="confirmPassword" validate="{ required:true,rangelength:[4,16],equalTo:new_m_password,messages:{required:'确认密码不能为空',rangelength:'密码至少4位',equalTo:'两次密码不一致'}}">
                </div>
                <input type="hidden" name="m_id" value="{$info.m_id}">
                <input type="hidden" name="m_name" value="{$info.m_name}" id="m_name">
                <div class="orderD orderE">
                    <span class="addr_edit"></span>
                    <button type="button" class="confirm_save" id="ajax_changePass" style="background-color:#ffffff;color:#5f1785">保存</button>
                    <span class="addr_edit"></span>
                </div>
            </div>
        </div>
        </form>

    </div>
<!--/container-->
<script type="text/javascript">
            $("document").ready(function(){
                var formdata = $("#my_doedit").serialize();

                var currYear = (new Date()).getFullYear();
                var opt={};
                opt.date = {preset : 'date'};
                //opt.datetime = { preset : 'datetime', minDate: new Date(2012,3,10,9,22), maxDate: new Date(2014,7,30,15,44), stepMinute: 5  };
                opt.datetime = {preset : 'datetime'};
                opt.time = {preset : 'time'};
                opt.default = {
                    theme: 'android-ics light', //皮肤样式
                    display: 'modal', //显示方式
                    mode: 'scroller', //日期选择模式
                    lang:'zh',
                    rows:3,
                    startYear:currYear - 50, //开始年份
                    endYear:currYear + 10 //结束年份
                };
                var optDateTime = $.extend(opt['datetime'], opt['default']);
                $("#m_birthday").mobiscroll(optDateTime).datetime(optDateTime);

                $("#my_doedit").validate({
                    submitHandler:function(form){
                        $("#my_doedit").ajaxSubmit({
                            url:"{:U('Wap/My/doEdit')}",
                            dataType:"json",
                            type:"post",
                            success:function(msgObj){
                                if(msgObj.status == 1){
                                    alert('会员信息修改成功');
                                   window.location.href ="{:U('Wap/Ucenter/index')}";
                                }else{
                                    $.ThinkBox.error(msgObj.info);
                                    return false;
                                }
                            }
                        });
                    },
                    rules : {
                        m_email : {
                            //required:true,
                            email:true,
                            remote : '/Wap/My/checkEmail'
                        }
                    },
                    messages:{
                      m_email:{
                          email:"邮件格式不符合",
                      }
                    }
                });
            });
</script>
<script type="text/javascript">
   $(function(){
    /****START***处理修改密码************/

    $('.spanWrong').hide();
    $('#edit_changePass').validate({
        errorPlacement: function(error, element) {
        },
        showErrors: function(errors) {
            for (var name in errors) {
                $('#' + name).parent('div').next().children('span').show();
                $('#' + name).parent('div').next().children('span').html(errors[name]);
            }

            return false;
        },
        onkeyup: false,
        onfocusout: false
    });
    $('.spanWrong').hide();
    var ti;
    $("#ajax_changePass").click(function() {
        $('.spanWrong').html('');
        $('.spanWrong').hide();
        var res = $('#edit_changePass').validate();

        if (res) {
            var data = $('#edit_changePass').serialize();
            var url = "{:U('/Wap/My/doChange')}";

            $.post(url, data, function(msgObj) {

                if(msgObj.success == '1'){
                    $(".member_editpass").show();
                    $(".member_editpass b").html(msgObj.msg);
//                    ti = setTimeout(function(){
//                        location.href = '/Wap/User/doLogout';
//                    },2000)
                    window.location.href = "/Wap/User/doLogout";
                    return false;
                }else{
                    $(".member_editpass").show();
                    $(".member_editpass b").html(msgObj.msg);
                    return false;
                }
            }, 'json');
            $(":input").val('');
        }
    });

    /****END****处理修改密码************/
   });
</script>

